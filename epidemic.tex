% Created 2020-03-28 Sat 23:19
% Intended LaTeX compiler: pdflatex
\documentclass[10pt,oneside]{scrartcl}
\usepackage{myhandout}
\author{N. Murata}
\date{\today}
\title{感染症の確率シミュレーション\\\medskip
\large 数理モデルと相転移現象}
\hypersetup{
 pdfauthor={N. Murata},
 pdftitle={感染症の確率シミュレーション},
 pdfkeywords={},
 pdfsubject={},
 pdfcreator={Emacs 26.3 (Org mode 9.3.1)}, 
 pdflang={Japanese}}
\begin{document}

\maketitle

\section{はじめに}
\label{sec:org6cc3666}

感染爆発(pandemic)を防ぐために，
外出の抑制など感染者との接触の機会を減らす努力が行われているが，
数理的な観点からこれがどのように影響するかを定性的に調べる．

以降の実験はR言語を用いて行っている．
実験に用いたRscriptは
\href{https://github.com/noboru-murata/epidemic-model}{GitHub}
から参照できる．

\section{数理モデル}
\label{sec:org0fd8ca0}
人が接触して感染症が拡大している過程は，
数理的にはグラフ上の確率的な拡散過程としてモデル化することができる．

ウイルスの拡散に限らず，
噂の伝搬や情報の漏曳など
ある対象から別の対象へ繋がる経路を通って，
何かが伝わる現象のモデル化として一般化できる．
グラフとは頂点 (vertex, node) と辺 (link, edge) からなり，
複数の対象の関連性を表現するための数学的な道具である．

まず，感染のモデルを記述するための用語を定義する．
\begin{description}
\item[{頂点}] グラフの構成要素で，本稿では人に対応する．
以下では \(i\) 番の人を表す場合に頂点 \(i\) と書く．
\item[{辺}] グラフのもう一つの構成要素で，頂点同士の繋がりを表す．
頂点 \(i\) と \(j\) の間に辺があるとき，これを辺 \(ij\) と書く．
感染の可能性のある接触機会の有無を辺の有無で表し，
実際に感染するかどうかは以下の感染確率で表現する．\footnote{ここで考える接触はいわゆる濃厚接触に限らず，
比較的密集した空間に同時に留まることがあり，
感染を引き起こす可能性のあるものを含めて考えることとする．
例えば，
会社の同じ部署にいる，
あるいは同じエレベータや電車などを使うなどを想定すれば良い．}
\item[{感染確率}] 感染者と未感染者が接触の機会を持ったときに感染が起こる確率を表す．\footnote{接触機会に対して必ずしも感染が起こるとは限らないので，
この不確定性を確率的なものとして取り扱う．
接触機会として濃厚接触のみを考える場合は，
感染確率を1に近づければよい．}
\item[{潜伏期間}] 感染から発症までの期間を指す．この期間の接触は感染を引き起さないとする．
\item[{発症期間}] 感染者から他者に感染することが可能な期間を指す．\footnote{医学的な用語とは齟齬があるが，
モデルを簡潔に記述するために
発症してはじめて他者に感染させる可能性がある
ものとして扱う．}
感染者は潜伏期間および発症期間の間は自由に動けるものとし，
以降は隔離されると考える．
\end{description}

さて，これらの概念を用いて簡便な感染過程を考える．

各頂点は，
未感染(susceptible)，
潜伏(latent)，
発症(present),
隔離(removed)の4状態を取るものとする．
未感染以外の状態(潜伏・発症・隔離)を
感染(infected)と呼ぶことにする．

感染した頂点は潜伏期間ののち発症し，
他者に感染可能となる発症期間に以降する．
発症した頂点と直接辺で結ばれている未感染の頂点は，
感染確率に従って感染し潜伏に遷移するか，
感染せずにそのまま未感染の状態を維持する．
発症した頂点は発症期間を経て隔離されるものとする．
現実の過程では，
\begin{itemize}
\item 感染確率 (他者に感染させる確率)
\item 潜伏期間 (感染から発症に至る期間)
\item 発症期間 (隔離されるまで感染を媒介する期間)
\end{itemize}
のいずれもが感染者ごとに異なると考えられるが，
ここでは簡単のため全ての感染者に対して同一であるとしてモデル化する．

記号を定義し，定式化すると以下のようになる．

時刻 \(t\) における頂点 \(i\) の状態を \(S_{i}(t)\) で表し，
潜伏期間を \(\Delta L\) ，
発症期間を \(\Delta P\) で表すことにする．
頂点は非負の整数値を取り，
その値はそれぞれ以下の状態に対応する．
\begin{align}
  S_{i}(t)\in\mathcal{N}_{S}
  &=\braces{0}&&\text{(未感染)}\\
  S_{i}(t)\in\mathcal{N}_{L}
  &=\braces{1,\dotsc,\Delta L}&&\text{(潜伏)}\\
  S_{i}(t)\in\mathcal{N}_{P}
  &=\braces{\Delta L+1,\dotsc,\Delta P}&&\text{(発症)}\\
  S_{i}(t)\in\mathcal{N}_{R}
  &=\braces{\Delta P+1,\dotsc}&&\text{(隔離)}
\end{align}
% \begin{equation}
%   S_{i}(t)
%   =
%   \begin{cases}
%     0,&\text{(未感染)}\\
%     [1,\Delta L] &\text{(潜伏)}\\ 
%     \Delta L +[1,\Delta P] &\text{(発症)}\\
%     -1 &\text{(隔離)}
%   \end{cases}
% \end{equation}
したがって，
状態\(S_{i}(t)\) には
頂点 \(i\) が感染してからの単位時間数が保持されることになる．

頂点 \(i\) と \(j\) の間に辺 \(ij\) があり，
頂点 \(i\) は未感染で，
頂点 \(j\) が発症期間にある場合，
感染は以下のように
感染確率 \(p\) で各辺ごとに独立に起こるとする．
\begin{align}
  \Prob{\text{頂点$j$から$i$に感染する}} &=p\\
  \Prob{\text{頂点$j$から$i$に感染しない}}&=1-p
\end{align}
状態の遷移は以下の規則に従って
単位時間ごとに行われるものとする．
\begin{equation}
  S_{i}(t+1)
  =
  \begin{cases}
    0,&\text{(未感染)}\\
    1,&\text{(新たな感染)}\\
    %-1,&\text{(隔離)}\;S_{i}(t)=-1\;\text{または}\;\Delta L + \Delta P\\
    S_{i}(t)+1&\text{(それ以外)}
  \end{cases}
\end{equation}
以上が，基本的なモデルとなる．

現実を模擬するには，
\begin{itemize}
\item どのようなグラフ構造(人と人の関係を表す集団の繋がり)を想定するのか?
\item 離散時間モデルの単位時間(以下では日を想定する)に対して潜伏期間，発症期間をどのように設定するか?
\item 感染確率をどの程度に見積るのか?
\end{itemize}
という点が肝要となる．

\section{感染の推移}
\label{sec:org56cd8ed}

まず，比較的小さなグラフを用いて
感染モデルの数値実験を行い，
その結果を視覚化する．

以下では集団のグラフ構造として
Watts-Strogatzのモデルを用いる．\footnote{Watts, D., Strogatz, S. Collective dynamics of ‘small-world’ networks. Nature 393, 440–442 (1998). \url{https://doi.org/10.1038/30918}}
このモデルは
リング状に配置された頂点の近傍にのみ辺がある規則的なグラフを初期値とし，
適当な確率で辺の張り替えを行って生成されるグラフである．
辺の総数は変わらないが，
辺を張り替える確率を制御することで，
規則的なグラフからランダムなグラフまで
さまざまなグラフを生成することができる．\footnote{たとえば \href{https://jp.mathworks.com/help/matlab/math/build-watts-strogatz-small-world-graph-model.html}{ワッツ・ストロガッツのスモール ワールド グラフのモデル作成 @ MathWarks} 
などを参照．}
図\ref{fig:exp1-1}に示したのは，
頂点数30，
初期近傍数6，
張替確率を0,0.05,1とした場合に生成されるグラフの例である．

\begin{figure*}%[htbp]
  \centering
  \GraphFile{figs/exp1}
  \myGraph[.3]{張替確率$=0$(規則的なグラフ)}
  \myGraph[.3]{張替確率$=0.05$}
  \myGraph[.3]{張替確率$=1$(ランダムグラフ)}
  \sidecaption{Watts-Strogatzのモデル．
    張替確率を変えることによって規則的な構造から
    ランダムな構造に変化することがわかる．
    \label{fig:exp1-1}}
\end{figure*}

\begin{figure}[htbp]
  \sidecaption{感染拡大の確率シミュレーション．
    (a)-(g)は感染状態の遷移を，
    (h)は感染率(感染した頂点の数/全頂点数)の推移を示す．
    頂点の色は状態に対応し
    \newline
    \begin{tabular}{l@{ : }l}
      白色 & 未感染\\
      黄色 & 潜伏\\
      赤色& 発症\\
      灰色& 隔離
    \end{tabular}
    \newline
    である．
    時間経過とともに辺を伝わって感染が拡大していく様子がわかる．
    この実験設定では30日でほぼ全員が感染した状態になる．
    % 頂点の色は状態に対応し，
    % 白色は未感染，黄色は潜伏，赤色は発症，灰色は隔離に対応する．
    % 時間経過とともに未感染者が減少していく様子がわかる．
    \label{fig:exp1-2}}
  \centering
  \myGraph{$t=1$}
  \setcounter{GraphPage}{8}\myGraph{$t=5$}
  \setcounter{GraphPage}{13}\myGraph{$t=10$}
  \setcounter{GraphPage}{18}\myGraph{$t=15$}
  \setcounter{GraphPage}{23}\myGraph{$t=20$}
  \setcounter{GraphPage}{28}\myGraph{$t=25$}
  \setcounter{GraphPage}{33}\myGraph{$t=30$}
  \myGraph{感染率の推移}
\end{figure}

次に，
表\ref{tab:exp1}に示すパラメタを用いて
感染の拡大する様子を模擬した数値実験の結果を
図\ref{fig:exp1-2}に示す．
図(a)は系全体の初期状態である．
頂点同士を結ぶ辺の数から
各頂点の接触機会は6程度であることが見てとれる．
頂点の状態は色で区別され，
白色は未感染，黄色は潜伏，赤色は発症，灰色は隔離に
対応している．
図(a)から(g)までは，
時間(以下単位時間を1日と考える)の経過とともに
感染状態がどのように拡散し遷移していくかを示している．
実験設定では感染確率は0.5であるが，
発症期間を3日として実験しているので，
3日間で感染しない確率は \(1-0.5^3=0.875\) である．
したがって接触している3日間でほぼ全ての頂点に感染が起こり，
系全体に感染が拡大していく様子が見てとれる．
全頂点数に対する感染した頂点の数を感染率と定義し，
図(h)にこの推移を示している．
感染者が少ない初期は拡がり方(感染率)はゆっくりとしているが，
拡がり始めると指数的に速度が上昇することがわかる．

\begin{margintable}
  \caption{実験設定}
  \label{tab:exp1}
  % \centering
  \small
  \begin{tabular}{ll}
    \toprule
    パラメタ&値 \\
    \midrule
    頂点数&100 \\
    初期近傍&6\;($3\times2$) \\
    張替確率&0.05 \\
    感染確率&0.5 \\
    潜伏期間&3 \\
    発症期間&3 \\
    \bottomrule
  \end{tabular}
\end{margintable}

\section{確率的なばらつきの評価}
\label{sec:org1939554}

確率的な数値実験では，
乱数系列の違いによって結果はばらつくことになる．
このため複数回の実験により可能性を網羅し，
実験で得られる知見の妥当性を担保する必要がある．\footnote{多数回の実験は時間や計算資源といったコストが掛かるため，
知りたいことが単一または少数の実験でわかるなら，
少ない実験で済ませたい場合もある．
このため，
単一の実験でわかることとわからないことを見極める必要がある．}

以下の実験では，
こうしたばらつきがどの程度あるかを確認する．
乱数によって生成している不確定な項目としては
\begin{itemize}
\item 発症した患者から未感染者への感染
\item 感染の発生源
\item 集団のグラフ
\end{itemize}
があるので，これらを順に検討する．
ここでも集団のグラフ構造の生成には
Watts-Strogatzのモデルを用いることとし，
実験の基本的な設定を表\ref{tab:exp2}にまとめる．

\begin{margintable}
  \caption{実験設定}
  \label{tab:exp2}
  % \centering
  \small
  \begin{tabular}{ll}
    \toprule
    パラメタ&値 \\
    \midrule
    頂点数&10000 \\
    初期近傍&50\;($25\times2$) \\
    張替確率&0.05 \\
    感染確率&0.04 \\
    潜伏期間&3 \\
    発症期間&3 \\
    \bottomrule
  \end{tabular}
\end{margintable}

まず，
集団のグラフも初期の感染者も固定して，
各辺で感染が起こるかどうかのみランダムに選択したとき，
どの程度結果に違いがあるのか確認する．
感染の推移を図\ref{fig:exp2-1}に示す．
左図は集団全体に対する感染者の比率の推移を，
右図は感染者数の対数値(常用対数)の推移を示したものである．
感染の拡大期には患者数 \(X(t)\) は指数的に増加する．
\begin{equation}
  X(t)\simeq C\exp(\lambda t)
  % (=C 10^{\lambda' t})
\end{equation}
このとき
\begin{equation}
  \frac{X(t+1)}{X(t)}
  =\exp(\lambda)
\end{equation}
であるから，
\(\lambda\) は
単位時間あたりの感染者の増加率(感染速度)を表す量となる．
感染者数 \(X(t)\) の両辺の対数を取ると
\begin{equation}
  \log X(t) \simeq \lambda t + \log C
\end{equation}
となることから，
感染者数の対数\footnote{図では人数に換算しやすいように常用対数を用いたが，
対数の底は適宜取り直せばよい．}
を示した右図の傾きから
指数の係数 \(\lambda\) を推定することができる．
さて，
図\ref{fig:exp2-1}の左図を見ると
初期の拡がり方にばらつきはあるものの，
右図から感染が拡大してからの速度はほぼ同じであることがわかる．
したがって，
感染が起こるかどうかの確率的な選択は
拡大開始の時期に影響を与えるが，
感染者が指数的に増大する時期の感染速度には
ほとんど影響しないことがわかる．

\begin{figure*}%[htbp]
  \centering
  \GraphFile{figs/exp2}
  \myGraph{感染率の推移}
  \myGraph{感染者数(常用対数)の推移}
  \sidecaption{感染の確率的な選択によるばらつき．
    感染拡大の始まる時期は異なるが，
    拡大の指数的な速度の性質はほとんど変わらないことがわかる．
    \label{fig:exp2-1}}
\end{figure*}

次に感染の発生源の違いによるばらつきを確認する．
集団のグラフを固定して，
初期感染者をランダムに変えて実験した結果を
図\ref{fig:exp2-2}に示す．
図\ref{fig:exp2-1}と同様に
感染の拡大が開始される時間にばらつきはあるが，
拡大速度はほぼ同様であることが確認できる．

\begin{figure*}%[htbp]
  \centering
  \myGraph{感染率の推移}
  \myGraph{感染者数(常用対数)の推移}
  \sidecaption{感染の発生源の違いによるばらつき．
    前の場合と同様に，
    感染拡大の始まる時期は異なるが，
    拡大の指数的な速度はほとんど変わらないことがわかる．
    \label{fig:exp2-2}}
\end{figure*}

最後に，
初期近傍と張替確率を固定してグラフを複数生成し，
それぞれのグラフ上の感染の推移を調べた結果を
図\ref{fig:exp2-3}に示す．
この実験でも同様に，
初期の拡がり方にばらつきはあるものの，
感染が拡大してからの速度はほぼ同じである．
したがって，集団のグラフ構造の特性が同じであれば，
感染の推移の性質は同様であることがわかる．

\begin{figure*}%[htbp]
  \centering
  \myGraph{感染率の推移}
  \myGraph{感染者数(常用対数)の推移}
  \sidecaption{同じ特性とつグラフにおける感染の推移のばらつき．
    前の2つの実験と同様に，
    感染拡大の動的な性質はほとんど変わならいことがわかる．
    \label{fig:exp2-3}}
\end{figure*}

以上より，
確率的な数値実験により，
感染の拡大が始まる時期にばらつきがあるものの，
拡大の動的な性質は維持されていることがわかる．
以降のいくつかの項においては，
1つの実験結果を見ながら
拡大の速度の定性的な議論を行うこととする．

\section{グラフ構造の特性の影響}
\label{sec:org1f04a86}

次に集団の関係をモデル化するグラフ構造の違いが，
感染の拡大にどのように影響を与えるか確認する．

グラフの生成モデルは様々なものが提案されているが，
これまで用いてきた
Watts-Strogatzのモデルに限定して，
その生成パラメタの変化が感染の拡がり方に及ぼす影響を調べることとする．

先にも述べたように
Watts-Strogatzのモデルは
規則的なグラフとランダムなグラフの中間的なグラフ構造を
生成することができるが，
ここで議論する特性パラメタとしては
\begin{itemize}
\item 初期グラフの近傍数(小さければ疎，大きければ密)
\item 張替確率(小さければ規則的，大きければランダム)
\end{itemize}
を考える．

まず，初期グラフの近傍数の影響を調べた結果を
図\ref{fig:exp3-1}に示す．
左右の図は，
前項と同様にそれぞれ感染率の推移と感染者数の対数の推移である．
また近傍数以外の実験設定は
表\ref{tab:exp2}の値を用いている．

近傍数が最も小さい10のときは，
感染は集団全体に拡がることなく局所的な発症のみで終息している．
それ以外では感染はほぼ集団全体に蔓延しているが，
その中でも近傍数が少ない場合には拡大の速度は小さい．
辺の総数は近傍数 \(\times\) 頂点数であるため，
感染の可能性が近傍数に比例して増大して
感染速度が増加すると考えられる．

一方，ある程度以上の近傍数になると
速度にそれほど大きな違いはないことがわかる．
感染に寄与する辺は一方が感染，もう一方が未感染であるが，
ある程度の近傍があれば十分な速度で感染が拡がり，
辺の両端が短時間で感染者になり，
結果として感染の伝播に寄与しなくなると考えられる．

\begin{figure*}%[htbp]
  \centering
  \GraphFile{figs/exp3}
  \myGraph{感染率の推移}
  \myGraph{感染者数(常用対数)の推移}
  \sidecaption{初期近傍数の影響．
    近傍が最も少ないとき感染の拡大は途中で停止している．
    近傍数が増加するに従って感染速度は上がるが，
    ある程度で速度はほぼ飽和する．
    \label{fig:exp3-1}}
\end{figure*}

次に，
張替確率を0から1まで変えて，
その影響を調べた結果を
図\ref{fig:exp3-2}に示す．
張替確率が0の場合は近傍数が一定のリング状の規則的なグラフであり，
1の場合は平均近傍数が初期値グラフと同じランダムなグラフとなる．
このモデルで生成されたグラフは
張替確率を変えても辺の総数は変わらず，
また各頂点から出る辺の数も平均的に変わらないが，
大きな張替確率で
ランダムになるほどリングの反対側に直接繋がる辺が存在する確率が高くなる．
ある頂点からリングの反対側の頂点への経路は，
規則的なグラフにおいては
辺の存在する隣接した頂点を順に辿って到達しなくてはいけないが，
ランダムなグラフでは
直接リングの反対側付近にある頂点に移動できる可能性が高いので，
経由しなくてはならない頂点の数は減少することになる．

1次元に配置した頂点間のユークリッド距離を空間上の距離と呼ぶことにする．
一方，グラフ上の距離を
ある頂点から他の頂点に移動するために必要な最小の辺の数と定義する．
2つの頂点が直接辺で繋がっていれば距離1，
別の頂点1つを経由して移動できる場合は距離2となる．
規則的な場合は空間上の距離とグラフ上の距離はほぼ同じであるが，
ランダムになると空間上の距離に比べてグラフ上の距離は平均的には著しく短くなる．\footnote{この考え方は探索の高速化のためにデータベースなどでも利用されている．}

グラフ上の距離は感染が伝達する時間に比例する
短ければ短時間で感染し，長ければ感染には時間が掛かる．
このことから，
グラフ全体に感染が拡がる時間は，
頂点間のグラフ上の平均距離に比例することが予想される．

さて，
張替確率が0の規則的なグラフの場合は，
感染の伝播が一定数で増加する特殊な伝播となっている．
上で考察したように，
規則的なグラフでは
最も遠い反対側の頂点に感染が伝わるまで順番に伝染していくため
と考えられる．

一方，
張替確率が0以外では，
一旦拡大しはじめると指数的に感染率が増加して蔓延している．
また張替確率がある程度大きければ，
ほぼ同じ速度で感染が拡大していることが見てとれる．
ランダムネスがちょっとあるだけで
感染の推移の性質ががらりと変わるのは，
上で考察したように，
任意の2頂点間の平均的な距離が短くなるため，
感染速度が拡大すると考えられる．\footnote{視点を変えて考えることもできる．
あるグラフの頂点同士の距離が与えられると，
その距離を実現するように
適当な次元(多くとも頂点数-1)の空間に
頂点を配置する(座標を与える)ことができる(多次元尺度構成法)．
規則的なグラフはもともとの配置に従って低次元空間の座標が与えられ，
ランダムなグラフの距離を実現するためには高次元空間の座標を与える必要がある．
ある1点から感染が拡大していく状況を想定すると，
これは球面波が拡がっていく様子と捉えることができ，
経過時間を半径とする球面内に含まれている点が感染者数に対応する．
したがって感染者の増大の仕方は
頂点が配置される空間の次元に依存し，
高次元空間ほど増大の仕方が急峻であることがわかる．}

\begin{figure*}%[htbp]
  \centering
  \myGraph{感染率の推移}
  \myGraph{感染者数(常用対数)の推移}
  \sidecaption{張替確率の影響．
    確率が大きくなるにしたがって感染速度は増大するが，
    この設定では0.03を越えると速度に大きな差がなくなっている．
    \label{fig:exp3-2}}
\end{figure*}

以上より，
感染の拡大においては
\begin{itemize}
\item 頂点の平均的な近傍数が多い (接触する人数が多い)
\item グラフのランダムネスが高い (接触する人がばらばら)
\end{itemize}
ことが悪影響を与えていることがわかる．
実際の環境で人は移動しつつ他者と接触を持っているため，
移動経路上でさまざまな人と接触し，
また人により接触する人が異なるため，
集団のグラフは上記の悪影響の条件を備えていると考えられる．
逆に感染の拡大を防ぐためには，
近傍数が少なく規則的なグラフ構造にする必要があるが，
これは
感染しているか否かに関わらず，
移動が少なく，
空間上の距離の意味で近隣の少数の人としか接触しない状態を
維持しなくてはならないことになる．\footnote{これは多くの国・自治体が要請している状態に他ならない．}

\section{感染モデルの特性の影響}
\label{sec:org9807eb4}

単位時間を1日として話をしよう．

潜伏期間が長ければ，
感染の拡大速度が遅くなる

感染率の推移だけ見ると
拡大が始まる時期がずれているように見えるが，
対数表示すると明瞭に
指数増大の傾きが単調に減少していることがわかる．

潜伏期間の長さは速度に影響を与える．

\begin{figure*}%[htbp]
  \centering
  \GraphFile{figs/exp4}
  \myGraph{感染率の推移}
  \myGraph{感染者数(常用対数)の推移}
  \sidecaption{潜伏期間の影響．
    \label{fig:exp4-1}}
\end{figure*}

発症期間が長ければ
接触機会も増え，
実質的な感染の確率が増大する
ことが予想される．
単調に増えるわけではない．

辺での感染確率はほぼ1になる
1への近づき方は非常に速いので
ある程度以上に発症期間が長ければ影響は変わらない．

単純に計算
0.04*50*3 >1  なので

近傍の誰にも感染しない確率は?
(1-0.04)\textsuperscript{50}

発症期間，隔離されるまで隣の人にうつさない確率
(1-0.04)\textsuperscript{発症期間} 

うつす確率
1-(1-0.04)\textsuperscript{発症期間}

全ての人うつさない確率
(1-0.04)\textsuperscript{(発症期間*次数)} <- 非常に小さい

うつす確率
1-(1-0.04)\textsuperscript{(発症期間*次数)} ほとんど1

次数が大きい場合は発症期間の長さにはあまりよらずに
感染速度は飽和する．

逆に接触機会を減らすには
発症をすみやかに検知し，
隔離することが重要

感染者が隔離されるまでに1を越える人に感染させれば，
指数的(鼠算的)に感染者は増大する．
したがってこの確率が1を越えるかどうかがクリティカル
ただし，あとで見るように平均的に
この確率が1を越えるかどうかで
単純に決まる問題ではない．
4近傍で0.5がクリティカルというのは説明ができない．

1日の場合は感染速度は遅いが(傾きは小さい)
それ以外は速度にそれほど差はない．
この実験設定では．

\begin{figure*}%[htbp]
  \centering
  \myGraph{感染率の推移}
  \myGraph{感染者数(常用対数)の推移}
  \sidecaption{発症期間の影響．
    \label{fig:exp4-2}}
\end{figure*}

実質上は潜伏期間と発症期間の比率が重要
この比が感染の速度を決定していると考えられる．

潜伏期間の長さを単位時間と考えれば
両方のパラメタをいじる必要はない
数値実験上は
実際のパラメタと紐付けたいので，
例えば単位時間を1日として，
潜伏期間，発症期間をそれぞれ日を単位として考えた方がわかりやすい．

感染確率を変えると
少し異なる状況があらわれる

ある確率を境として
蔓延するかしないかが不連続に変化しているように見える

\begin{figure*}%[htbp]
  \centering
  \myGraph{感染率の推移}
  \myGraph{感染者数(常用対数)の推移}
  \sidecaption{感染確率の影響．
    \label{fig:exp4-3}}
\end{figure*}

より詳細にみる．
0.01を境に
ほとんど蔓延せずに終息するか，
大多数に感染が蔓延して終息するかに分岐していることがわかる．
相転移現象の一つ，
パーコレーションの一種と考えられる．

\begin{figure*}%[htbp]
  \centering
  \myGraph{感染率の推移}
  \myGraph{感染確率と感染者数}
  \sidecaption{感染確率の影響による相転移．
    \label{fig:exp4-4}}
\end{figure*}

\section{感染拡大の相転移}
\label{sec:orgaa397f5}

前項では
感染確率を動かしながら，
感染拡大の劇的な変化(一種の相転移現象)を見たが，
これは感染確率とグラフ構造の相対的な関係で現れる．
すなわち感染確率を固定して，
グラフ構造を変えながら観測することもできる．
ここでは
見通しを良くするために規則的なグラフを考え，
感染確率のみを動かす．


2次元の格子状に並んだ頂点の集合を考え，
各頂点がその4近傍と辺で結ばれた規則的なグラフを考える．

感染が蔓延するかどうかにだけ興味があるので，
感染の拡大を制御するパラメタについては
できるだけ簡便なものを考える．
表\ref{tab:exp5}のように設定する．

\begin{margintable}
  \caption{実験設定}
  \label{tab:exp5}
  % \centering
  \small
  \begin{tabular}{ll}
    \toprule
    パラメタ&値 \\
    \midrule
    頂点数&10000 \\
    近傍数&4 \\
    潜伏期間&0 \\
    発症期間&1 \\
    \bottomrule
  \end{tabular}
\end{margintable}

規則的ではあるが，
先の実験と同様に感染が拡大している
指数的ではなく
感染者は線形に増加している
図\ref{fig:exp5-1}に示す．

\begin{figure}[htbp]
  \sidecaption{キャプション
    \label{fig:exp5-1}}
  \centering
  \GraphFile{figs/exp5}
  \myGraph{$t=1$}
  \setcounter{GraphPage}{15}\myGraph{$t=15$}
  \setcounter{GraphPage}{30}\myGraph{$t=30$}
  \setcounter{GraphPage}{45}\myGraph{$t=45$}
  \setcounter{GraphPage}{60}\myGraph{$t=60$}
  \myGraph{感染率の推移}
\end{figure}

感染確率を変えて
複数回実験した結果を
図\ref{fig:exp5-2}に示す．

\begin{figure}[htbp]
  \sidecaption{キャプション
    \label{fig:exp5-2}}
  \centering
  \myGraph*{感染確率と感染率の関係}
\end{figure}

十分時間が経過したあとの終息結果
感染確率の違いにより感染率が変わる．
蔓延の仕方が異なる．
図\ref{fig:exp5-3}に示す．

図\ref{fig:exp5-2}で見たように
局所

\begin{figure*}%[htbp]
  \centering
  \myGraph[.3]{感染確率$=0.2$}
  \myGraph[.3]{感染確率$=0.5$}
  \myGraph[.3]{感染確率$=0.7$}
  \sidecaption{キャプション
    \label{fig:exp5-3}}
\end{figure*}


近似的な解析

無限遠点の極限を考える．
\begin{equation}
  Q
  =\Pr{\text{頂点$i$から無限遠点まで感染しない}}
  \quad\text{(頂点$i$によらない)}
\end{equation}

簡単な帰納的
\begin{align}
  Q
  &=\Pr{\text{頂点$i$から無限遠点に到達する経路がない}}\\
  &=\Pr{\text{頂点$i$の4近傍を経由して無限遠点に到達する経路がない}}\\
  &\simeq\Pr{\text{頂点$i$の1つの近傍$j$を経由して無限遠点に到達する経路がない}}^{4}\\
  &=\Pr{\text{頂点$i$から近傍に経路がない}\text{または}
    \text{近傍から経路がない}}^{4}\\
  &=\bigl(
    \underbrace{P_{\phantom{j}}}_{i\to j}
    \cdot\underbrace{Q}_{j\not\to\infty}+
    \underbrace{(1-P)}_{i\not\to j}
    \bigr)^{4}
\end{align}

4近傍の各点から無限遠への経路の有無は独立ではないので，
式は近似である．


感染確率 \(P\) に対して
以下の式を満たす \(Q\) がどのような値となるかを考えればよい．
\begin{equation}
  Q=\{P\times Q + (1-P)\}^{4},\;0<Q<1
\end{equation}

\begin{figure}%[htbp]
  \sidecaption{確率$Q$の満たす条件．
    \label{fig:exp6-1}}
  \centering
  \GraphFile{figs/exp6}
  \myGraph*{}
\end{figure}

この条件を図示すると
図\ref{fig:exp6-1}のようになる．
図は横軸を \(Q\)
縦軸を \(R\) として
2つの関数
\begin{align}
  R&=Q\\
  R&=\{P\times Q + (1-P)\}^{4}
\end{align}
を重ね描きしたもの
区間 \(0\le Q\le 1\) に含まれる交点が，
条件を満たす \(Q\) の値となる．
感染確率 \(P\) の大小によって
解が \(0\le Q\le 1\) の間を移動していく様子がわかる．

\begin{figure}%[htbp]
  \sidecaption{感染確率と全感染率の関係．
    \label{fig:exp6-2}}
  \centering
  \myGraph*{}
\end{figure}

確率 \(Q\) は感染が拡がらない確率なので，
終息期の全感染率は \(1-Q\) で表される．
感染確率 \(P\) と 
全感染率 \(1-Q\) の関係を示すと
図\ref{fig:exp6-2}となる．
これから閾値(この場合は \(p=0.25\))を越えると
急速に全感染率が1に近付いくていことがわかる．

\section{おわりに}
\label{sec:orgb10bcee}

感染症の場合，
人間が対応して変えられるのは
感染確率のみ

集団のネットワークは変えようがない．

感染確率は
接触機会と感染力の積

感染力はウイルス固有のものなので，
接触機会を減らすしかない．

感染確率を減らすことによって
蔓延を避けることができる．
ある閾値以下であれば，
局所的な感染で済むかもしれない．
蔓延するにしても拡大の速度を減少させ，
治療のための時間を稼ぐことができるかもしれない．

治療方法の確立，
治療体制の確保，
治療薬・予防薬，ワクチンの開発

状態としては二つ

孤立した領域での発症で済むか
全体に蔓延して終息

指数的に拡大していく場合には
指数の増大を決める時定数を小さくすることが必要

モデルの中のパラメタとこの時定数の関係を見てきた

結局人間がいじれるのは限られている．
\end{document}